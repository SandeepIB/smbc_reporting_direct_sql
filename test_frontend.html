<!DOCTYPE html>
<html>
<head>
    <title>CCR Frontend Test</title>
</head>
<body>
    <h1>CCR Frontend Debug Test</h1>
    <div id="status"></div>
    <button onclick="testCCRWorkflow()">Test CCR Analysis</button>
    <div id="results"></div>

    <script>
        const API_URL = 'http://localhost:8000';
        
        function log(message) {
            console.log(message);
            document.getElementById('status').innerHTML += '<div>' + message + '</div>';
        }
        
        async function testCCRWorkflow() {
            document.getElementById('status').innerHTML = '';
            document.getElementById('results').innerHTML = '';
            
            try {
                log('üîç Starting CCR Analysis Test...');
                log('API URL: ' + API_URL);
                
                // Test 1: Health check
                log('1. Testing health check...');
                const healthResponse = await fetch(`${API_URL}/health`);
                const healthData = await healthResponse.json();
                log('‚úÖ Health check successful: ' + JSON.stringify(healthData));
                
                // Test 2: Create test file
                log('2. Creating test file...');
                const testImageBlob = new Blob([new Uint8Array([
                    0x89, 0x50, 0x4E, 0x47, 0x0D, 0x0A, 0x1A, 0x0A, 0x00, 0x00, 0x00, 0x0D, 0x49, 0x48, 0x44, 0x52,
                    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x08, 0x06, 0x00, 0x00, 0x00, 0x1F, 0x15, 0xC4,
                    0x89, 0x00, 0x00, 0x00, 0x0D, 0x49, 0x44, 0x41, 0x54, 0x78, 0xDA, 0x63, 0x60, 0xF8, 0xCF, 0x50,
                    0x0F, 0x00, 0x03, 0x86, 0x01, 0x80, 0x5A, 0x34, 0x7D, 0x6B, 0x00, 0x00, 0x00, 0x00, 0x49, 0x45,
                    0x4E, 0x44, 0xAE, 0x42, 0x60, 0x82
                ])], { type: 'image/png' });
                
                const testFile = new File([testImageBlob], 'test_chart.png', { type: 'image/png' });
                log('‚úÖ Test file created: ' + testFile.name + ' (' + testFile.size + ' bytes)');
                
                // Test 3: Upload
                log('3. Testing upload...');
                const formData = new FormData();
                formData.append('files', testFile);
                
                const uploadResponse = await fetch(`${API_URL}/upload-images`, {
                    method: 'POST',
                    body: formData
                });
                
                log('Upload response status: ' + uploadResponse.status);
                
                if (!uploadResponse.ok) {
                    const errorText = await uploadResponse.text();
                    log('‚ùå Upload failed: ' + errorText);
                    return;
                }
                
                const uploadResult = await uploadResponse.json();
                log('‚úÖ Upload successful: ' + JSON.stringify(uploadResult));
                
                // Test 4: Configure
                log('4. Testing configuration...');
                const cropConfig = { rows: 2, cols: 3, enabled: true };
                
                const configResponse = await fetch(`${API_URL}/configure-cropping`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(cropConfig)
                });
                
                log('Config response status: ' + configResponse.status);
                
                if (!configResponse.ok) {
                    const errorText = await configResponse.text();
                    log('‚ùå Configuration failed: ' + errorText);
                    return;
                }
                
                const configResult = await configResponse.json();
                log('‚úÖ Configuration successful: ' + JSON.stringify(configResult));
                
                // Test 5: Analyze
                log('5. Testing analysis...');
                const analyzeResponse = await fetch(`${API_URL}/analyze`, {
                    method: 'POST'
                });
                
                log('Analysis response status: ' + analyzeResponse.status);
                
                if (!analyzeResponse.ok) {
                    const errorText = await analyzeResponse.text();
                    log('‚ùå Analysis failed: ' + errorText);
                    return;
                }
                
                const analysisResult = await analyzeResponse.json();
                log('‚úÖ Analysis successful!');
                document.getElementById('results').innerHTML = '<pre>' + JSON.stringify(analysisResult, null, 2) + '</pre>';
                
                log('üéâ All tests passed! CCR workflow is working correctly.');
                
            } catch (error) {
                log('üí• Test failed: ' + error.message);
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>